import "pe"
// (uint16(0) == 0x5A4D) and (uint32(uint32(0x3C)) == 0x00004550) exe

rule redline_malware{
    meta:   
        description = "RedLine c++"
        date = "2022-09-07"
		Filetype = "Win32 exe"
        malware_type = "backdoor"
        malware_family = "Backdoor:W32/RedLine"
        hash = "3d826d66d095fc0fac223471dc8332a4"    
    strings:
        $s1 = {66 3A 5C 64 64 5C 76 63 74 6F 6F 6C 73 5C 63 72 74 5F 62 6C 64 5C 73 65 6C 66 5F 78 38 36 5C 63 72 74 5C 73 72 63 5C} 
        $s2 = {78 69 77 75 77 6F 67 6F 78 61 70 65 78 69 66 6F 6D 65 6A 61 73 69 6B 65 63 6F 67 6F} 
        $s3 = {73 6F 78 65 78 69 62 6F 79 65 63 61 66 6F 76 6F} 
        $s4 = {78 6F 6A 69 6C 69}
        $s5 = {66 6F 73 6F 7A 65 77 6F 64 75 6D 69} 
        $s6 = {6E 6F 66 6F 77 75 78 61 62 69 76 65 79 6F 66 65 62 61 6C} 
    condition:
        uint16(0) == 0x5a4d and filesize < 500KB and any of them
        
}

rule Quasar_RAT_malware{
	meta:   
        description = "Malicious office macro vba code release rat dll file"
        date = "2022-09-17"
		Filetype = "Win32 dll"
        malware_type = "RAT"
        malware_family = "Quasar"
        hash = "9DB85BEA78A3BD6CEB1AD455191C542B"    
    strings:
        $s1 = {37 2E 30 2E 30 2E 32 [1-10] 32 30 32 32}
        $s2 = {0A 48 50 20 50 72 69 6E 74 65 72} 
        $s3 = "HP.Config" nocase
		$s4 = "PrinterKPI.pdb" nocase
    condition:
        uint16(0) == 0x5a4d 
		and filesize > 500KB 
		and pe.is_dll() 
		and pe.imphash() == "D0823F24EA6E7922288E5C17847E38F8"
		or 2 of ($s*)

}





